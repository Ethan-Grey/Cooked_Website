<!-- layout.html -->
<!DOCTYPE html>
{% load static %}
{% load socialaccount %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Cooking App{% endblock %}</title>
    <!-- Add AOS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/dropdown.css' %}">
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">          
          <a class="navbar-brand d-flex align-items-center text-uppercase fw-bold" href="/" alt="COOKED" style="font-size: 1.3rem;">Cooked</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="/" style="font-size: 1.3rem;">Home</a>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle ms-lg-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 1.3rem;">
                  Health & Diet
                </a>
                <ul class="dropdown-menu mobile-dropdown">
                  <li class="dropdown-header">Health-Conscious Options</li>
                  {% for type in health_filtered_recipe_types %}
                    <li><a class="dropdown-item" href="{% url 'recipes:category' category=type.recipetype|lower %}">{{ type.recipetype }}</a></li>
                  {% endfor %}
                </ul>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle ms-lg-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 1.3rem;">
                  Holidays
                </a>
                <ul class="dropdown-menu mobile-dropdown">
                  <li class="dropdown-header">Seasonal & Holiday Cuisine</li>
                  {% for type in holidays_filtered_recipe_types %}
                    <li><a class="dropdown-item" href="{% url 'recipes:category' category=type.recipetype|lower %}">{{ type.recipetype }}</a></li>
                  {% endfor %}
                </ul>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle ms-lg-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 1.3rem;">
                  Daily Recipes
                </a>
                <ul class="dropdown-menu mobile-dropdown">
                  <li class="dropdown-header">Everyday Meal Ideas</li>
                  {% for type in filtered_recipe_types %}
                    <li><a class="dropdown-item" href="{% url 'recipes:category' category=type.recipetype|lower %}">{{ type.recipetype }}</a></li>
                  {% endfor %}
                </ul>
              </li>
            </ul>
            
            <!-- Search Form -->
            <div class="d-flex flex-column flex-lg-row align-items-stretch align-items-lg-center">
              <form class="d-flex" action="{% url 'recipes:search' %}" method="GET">
                <input class="form-control me-2" style="border-radius: 2px;" type="search" name="q" placeholder="Search recipes..." aria-label="Search">
                <button class="btn btn-secondary" type="submit">Search</button>
              </form>

              <!-- User Menu -->
              {% if user.is_authenticated %}
              <div class="dropdown user-dropdown">
                <a class="nav-link ms-lg-3" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                    <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                  </svg>
                </a>
                <ul class="dropdown-menu dropdown-menu-end mobile-dropdown" aria-labelledby="userDropdown">
                  <li><a class="dropdown-item" href="/users/profile/"><i class="bi bi-person"></i>User Details</a></li>
                  <li><a class="dropdown-item" href="/recipes/new-recipes"><i class="bi bi-plus-circle"></i>Create Recipes</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="/users/logout/"><i class="bi bi-box-arrow-right"></i>Logout</a></li>
                </ul>
              </div>
              {% else %}
              <a class="nav-link ms-lg-3" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                </svg>
              </a>
              {% endif %}
            </div>
          </div>
        </div>
    </nav>

    <div class="d-flex flex-column min-vh-100">
        <!-- Toast container for success messages -->
        <div class="toast-container position-fixed top-0 end-0 p-3">
            {% for message in messages %}
                {% if message.tags != 'error' and message.tags != 'warning' %}
                <div class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            {{ message }}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>

        {% block content %}
        {% endblock %}
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="login-content">
                        <!-- Left side with purple background and welcome message -->
                        <div class="login-welcome">
                            <div class="welcome-content">
                                <h1>Welcome back!</h1>
                                <p>You can sign in to access with your existing account.</p>
                            </div>
                            <div class="decorative-elements">
                                <div class="circle-1"></div>
                                <div class="circle-2"></div>
                                <div class="wave-line"></div>
                            </div>
                        </div>

                        <!-- Right side with login form -->
                        <div class="login-form-container">
                            <div class="login-form-content">
                                <h2>Sign In</h2>
                                <!-- Error message container -->
                                <div id="loginErrorContainer" class="alert alert-warning d-none" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <span id="loginErrorMessage"></span>
                                </div>
                                {% if form.errors %}
                                <div class="alert alert-warning" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    Invalid username/email or password.
                                </div>
                                {% endif %}
                                <form class="login-form" action="/users/login/" method="post">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <i class="bi bi-person form-icon"></i>
                                        <input type="text" name="username" class="form-control" placeholder="Username or Email" required>
                                    </div>
                                    <div class="form-group">
                                        <i class="bi bi-lock form-icon"></i>
                                        <input type="password" name="password" class="form-control" placeholder="Password" required>
                                    </div>
                                    <div class="form-options">
                                        <div class="remember-me">
                                            <input type="checkbox" id="remember-me" name="remember-me">
                                            <label for="remember-me">Remember me</label>
                                        </div>
                                        <a href="{% url 'account_reset_password' %}" class="forgot-password">Forgot password?</a>
                                    </div>
                                    <button type="submit" class="sign-in-btn">Sign In</button>
                                </form>

                                <!-- Google Sign In Button -->
                                <div class="social-login mt-4">
                                    <div class="divider">
                                        <span>or</span>
                                    </div>
                                    <a href="{% provider_login_url 'google' process='login' %}" 
                                       class="google-sign-in-btn"
                                       id="googleSignInBtn">
                                        <img src="https://www.google.com/favicon.ico" alt="Google" class="google-icon">
                                        Sign in with Google
                                    </a>
                                </div>

                                <div class="register-link">
                                    <p>New here? <a href="#" data-bs-toggle="modal" data-bs-target="#signupModal">Create an Account</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="login-content">
                        <!-- Left side with purple background and welcome message -->
                        <div class="login-welcome">
                            <div class="welcome-content">
                                <h1>Welcome to Cooked!</h1>
                                <p>Create an account to start sharing and discovering amazing recipes.</p>
                            </div>
                            <div class="decorative-elements">
                                <div class="circle-1"></div>
                                <div class="circle-2"></div>
                                <div class="wave-line"></div>
                            </div>
                        </div>

                        <!-- Right side with signup form -->
                        <div class="login-form-container">
                            <div class="login-form-content">
                                <h2>Create Account</h2>
                                <!-- Error message container -->
                                <div id="signupErrorContainer" class="alert alert-warning d-none" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <span id="signupErrorMessage"></span>
                                </div>

                                <form class="login-form" action="{% url 'users:register_email_password' %}" method="post">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <i class="bi bi-envelope form-icon"></i>
                                        <input type="email" name="email" class="form-control" placeholder="Email" required>
                                    </div>
                                    <div class="form-group">
                                        <i class="bi bi-lock form-icon"></i>
                                        <input type="password" name="password1" class="form-control" placeholder="Password" required>
                                    </div>
                                    <div class="form-group">
                                        <i class="bi bi-lock form-icon"></i>
                                        <input type="password" name="password2" class="form-control" placeholder="Confirm Password" required>
                                    </div>
                                    <button type="submit" class="sign-in-btn">Sign Up</button>
                                </form>

                                <!-- Google Sign Up Button -->
                                <div class="social-login mt-4">
                                    <div class="divider">
                                        <span>or</span>
                                    </div>
                                    <a href="{% provider_login_url 'google' process='signup' %}" 
                                       class="google-sign-in-btn"
                                       id="googleSignUpBtn">
                                        <img src="https://www.google.com/favicon.ico" alt="Google" class="google-icon">
                                        Sign up with Google
                                    </a>
                                </div>

                                <div class="register-link">
                                    <p>Already have an account? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Sign In</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Registration Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="login-content">
                        <!-- Left side with purple background and welcome message -->
                        <div class="login-welcome">
                            <div class="welcome-content">
                                <h1>Complete Your Profile</h1>
                                <p>Tell us a little more about yourself to complete your registration.</p>
                            </div>
                            <div class="decorative-elements">
                                <div class="circle-1"></div>
                                <div class="circle-2"></div>
                                <div class="wave-line"></div>
                            </div>
                        </div>

                        <!-- Right side with profile form -->
                        <div class="login-form-container">
                            <div class="login-form-content">
                                <h2>Profile Details</h2>
                                <!-- Error message container -->
                                <div id="profileErrorContainer" class="alert alert-warning d-none" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <span id="profileErrorMessage"></span>
                                </div>

                                <form class="login-form" action="{% url 'users:register_profile' %}" method="post" id="profileForm">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <i class="bi bi-person form-icon"></i>
                                        <input type="text" name="first_name" class="form-control" placeholder="First Name" required>
                                    </div>
                                    <div class="form-group">
                                        <i class="bi bi-person form-icon"></i>
                                        <input type="text" name="last_name" class="form-control" placeholder="Last Name" required>
                                    </div>
                                    <div class="form-group">
                                        <i class="bi bi-at form-icon"></i>
                                        <input type="text" name="username" class="form-control" placeholder="Choose a Username" required>
                                    </div>
                                    <button type="submit" class="sign-in-btn">Complete Registration</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-4 mt-5 border-top">
      <div class="container">
          <!-- Top Section with Logo - Always visible -->
          <div class="row mb-4 align-items-center">
              <div class="col-12 text-center text-md-start mb-3 mb-md-0">
                  <h4 class="fw-bold text-uppercase">cooked</h4>
              </div>
          </div>
  
          <!-- Main Footer Content -->
          <div class="row">
              <!-- Social Media Section - Always visible -->
              <div class="col-12 col-md-8">
                  <div class="d-flex flex-wrap gap-3 mb-4 justify-content-center justify-content-md-start">
                      <p class="fw-semibold mb-0 me-2">Follow Us:</p>
                      <a href="https://facebook.com" class="text-light" target="_blank">
                          <i class="bi bi-facebook"></i>
                      </a>
                      <a href="https://instagram.com" class="text-light" target="_blank">
                          <i class="bi bi-instagram"></i>
                      </a>
                      <a href="https://pinterest.com" class="text-light" target="_blank">
                          <i class="bi bi-pinterest"></i>
                      </a>
                      <a href="https://tiktok.com" class="text-light" target="_blank">
                          <i class="bi bi-tiktok"></i>
                      </a>
                      <a href="https://youtube.com" class="text-light" target="_blank">
                          <i class="bi bi-youtube"></i>
                      </a>
                  </div>
              </div>
  
              <!-- Developer info - Hidden on mobile -->
              <div class="col-md-4 d-none d-md-block">
                  <ul class="list-unstyled d-flex gap-2">
                      <p class="fw-semibold">Developer:</p>
                      <li><a href="#" class="text-light text-decoration-none">Ethan Grey</a></li>
                      <li><a href="#" class="text-light text-decoration-none">gethan101@gmail.com</a></li>
                      <li><a href="https://www.linkedin.com/in/ethan-grey-96889b319/" class="text-light text-decoration-none" target="_blank"><i class="bi bi-linkedin"></i></a></li>
                      <li><a href="https://github.com/Ethan-Grey" class="text-light text-decoration-none" target="_blank"><i class="bi bi-github"></i></a></li>
                  </ul>
              </div>
          </div>
  
          <!-- Developer Words - Hidden on mobile -->
          <div class="row border-top pt-3 mt-2 d-none d-md-flex">
              <div class="col-md-6 text-center text-md-start mb-2 mb-md-0">
                  <div class="d-flex align-items-center">
                      <span class="fs-5 text-danger me-2">
                          <i class="bi bi-cup-hot-fill"></i>
                      </span>
                      <span>Cooking App is part of the <a href="#" class="text-light text-uppercase">cooked</a> family.</span>
                  </div>
              </div>
              <div class="col-md-6 text-center text-md-end">
                  <small>&copy; 2025 COOKED App | All Rights Reserved</small>
              </div>
          </div>
  
          <!-- Copyright - Mobile only version -->
          <div class="row mt-3 d-md-none">
              <div class="col-12 text-center">
                  <small>&copy; 2025 COOKED App | All Rights Reserved</small>
              </div>
          </div>
      </div>
  </footer>

    <!-- Bootstrap JS and other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script src="{% static 'js/backToTop.js' %}"></script>
    <script src="{% static 'js/profile_nav.js' %}"></script>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" class="btn btn-secondary rounded-circle position-fixed" style="bottom: 30px; right: 30px; width: 50px; height: 50px; display: none; z-index: 1000;">
        <i class="bi bi-arrow-up"></i>
    </button>

    <script>
        // Initialize AOS
        AOS.init({
            offset: 120,
            delay: 0,
            duration: 1000,
            easing: 'ease',
            once: true,
            mirror: false,
            anchorPlacement: 'top-bottom'
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Function to show error in the login modal
            function showLoginError(message) {
                const errorContainer = document.getElementById('loginErrorContainer');
                const errorMessage = document.getElementById('loginErrorMessage');
                errorMessage.textContent = message;
                errorContainer.classList.remove('d-none');
                
                // Show the login modal
                var loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
            }

            // Function to hide error in the login modal
            function hideLoginError() {
                const errorContainer = document.getElementById('loginErrorContainer');
                errorContainer.classList.add('d-none');
            }

            // Function to decode URL parameters
            function decodeURLParam(param) {
                return decodeURIComponent(param.replace(/\+/g, ' '));
            }

            // Handle Google sign-in button click
            document.getElementById('googleSignInBtn').addEventListener('click', function(e) {
                // Hide any existing error messages when starting a new login attempt
                hideLoginError();
            });

            // Check URL for error parameters
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');
            const message = urlParams.get('message');
            const email = urlParams.get('email');

            // If we have error parameters, show them in the modal
            if (error && message) {
                showLoginError(decodeURLParam(message));
                
                // Clear the URL parameters after showing the error
                if (window.history && window.history.replaceState) {
                    const newURL = window.location.pathname;
                    window.history.replaceState({}, document.title, newURL);
                }
            }

            // Clear error message when modal is closed
            document.getElementById('loginModal').addEventListener('hidden.bs.modal', function () {
                hideLoginError();
            });

            // Initialize toasts
            var toastElList = [].slice.call(document.querySelectorAll('.toast'));
            var toastList = toastElList.map(function(toastEl) {
                var toast = new bootstrap.Toast(toastEl, {
                    autohide: true,
                    delay: 3000
                });
                toast.show();
                return toast;
            });

            // Highlight current active menu item
            const currentPath = window.location.pathname;
            
            // Check all dropdown items
            document.querySelectorAll('.dropdown-item').forEach(item => {
                const itemPath = item.getAttribute('href');
                if (itemPath && currentPath.includes(itemPath)) {
                    item.classList.add('active');
                    // Also make the parent dropdown toggle active
                    const parentDropdown = item.closest('.dropdown');
                    if (parentDropdown) {
                        const toggle = parentDropdown.querySelector('.dropdown-toggle');
                        if (toggle) toggle.classList.add('active');
                    }
                }
            });
            
            // Check top-level nav links
            document.querySelectorAll('.nav-link:not(.dropdown-toggle)').forEach(link => {
                const linkPath = link.getAttribute('href');
                if (linkPath && ((linkPath === '/' && currentPath === '/') || 
                    (linkPath !== '/' && currentPath.includes(linkPath)))) {
                    link.classList.add('active');
                }
            });

            // Show login modal if there are form errors
            {% if form.errors %}
                var loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
            {% endif %}

            // Handle signup form submission
            const signupForm = document.querySelector('#signupModal form');
            if (signupForm) {
                signupForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Hide any existing error messages
                    const errorContainer = document.getElementById('signupErrorContainer');
                    errorContainer.classList.add('d-none');

                    // Get form data
                    const formData = new FormData(this);

                    // Send AJAX request
                    fetch(this.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Hide signup modal
                            const signupModal = bootstrap.Modal.getInstance(document.getElementById('signupModal'));
                            signupModal.hide();

                            // Show profile modal
                            const profileModal = new bootstrap.Modal(document.getElementById('profileModal'));
                            profileModal.show();
                        } else {
                            // Show error message
                            const errorMessage = document.getElementById('signupErrorMessage');
                            if (data.message) {
                                errorMessage.textContent = data.message;
                            } else if (data.errors) {
                                errorMessage.textContent = Object.values(data.errors)[0];
                            }
                            errorContainer.classList.remove('d-none');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const errorMessage = document.getElementById('signupErrorMessage');
                        errorMessage.textContent = 'An error occurred. Please try again.';
                        errorContainer.classList.remove('d-none');
                    });
                });
            }

            // Handle profile form submission
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Hide any existing error messages
                    const errorContainer = document.getElementById('profileErrorContainer');
                    errorContainer.classList.add('d-none');

                    // Get form data
                    const formData = new FormData(this);

                    // Send AJAX request
                    fetch(this.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Hide profile modal
                            const profileModal = bootstrap.Modal.getInstance(document.getElementById('profileModal'));
                            profileModal.hide();

                            // Show login modal with verification message
                            const loginErrorContainer = document.getElementById('loginErrorContainer');
                            const loginErrorMessage = document.getElementById('loginErrorMessage');
                            loginErrorContainer.className = 'alert alert-info';
                            loginErrorMessage.innerHTML = `
                                <i class="bi bi-envelope me-2"></i>
                                ${data.message}
                            `;
                            loginErrorContainer.classList.remove('d-none');

                            // Show login modal
                            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                            loginModal.show();

                            // Show success toast
                            const toast = document.createElement('div');
                            toast.className = 'toast align-items-center text-white bg-success border-0';
                            toast.setAttribute('role', 'alert');
                            toast.setAttribute('aria-live', 'assertive');
                            toast.setAttribute('aria-atomic', 'true');
                            toast.innerHTML = `
                                <div class="d-flex">
                                    <div class="toast-body">
                                        Registration successful! Please check your email.
                                    </div>
                                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                            `;
                            document.querySelector('.toast-container').appendChild(toast);
                            const bsToast = new bootstrap.Toast(toast);
                            bsToast.show();
                        } else {
                            // Show error messages
                            if (data.message) {
                                const errorMessage = document.getElementById('profileErrorMessage');
                                errorMessage.textContent = data.message;
                                errorContainer.classList.remove('d-none');
                            } else if (data.errors) {
                                const errorMessage = document.getElementById('profileErrorMessage');
                                errorMessage.textContent = Object.values(data.errors)[0];
                                errorContainer.classList.remove('d-none');
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const errorMessage = document.getElementById('profileErrorMessage');
                        errorMessage.textContent = 'An error occurred. Please try again.';
                        errorContainer.classList.remove('d-none');
                    });
                });
            }

            // Clear error messages when modals are hidden
            ['loginModal', 'signupModal', 'profileModal'].forEach(modalId => {
                document.getElementById(modalId).addEventListener('hidden.bs.modal', function () {
                    const errorContainer = document.getElementById(`${modalId.split('Modal')[0]}ErrorContainer`);
                    if (errorContainer) {
                        errorContainer.classList.add('d-none');
                    }
                });
            });
        });
    </script>
</body>
</html>